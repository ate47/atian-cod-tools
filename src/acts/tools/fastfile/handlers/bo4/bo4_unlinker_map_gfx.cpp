#include <includes.hpp>
#include <tools/fastfile/handlers/handler_game_bo4.hpp>
#include <tools/utils/raw_file_extractor.hpp>
#include <tools/utils/data_utils.hpp>

namespace {
	using namespace fastfile::handlers::bo4;
	using namespace games::bo4::pool;

	struct GfxVolumeDecal {
		uint64_t id;
		byte hidden;
		vec3_t localToWld[4];
		vec3_t wldToLocal[4];
		vec3_t halfExtents;
		vec3_t edgeFeather;
		vec4_t revealTextureUV;
		vec4_t uvBaseAndScale;
		vec4_t unka8;
		uintptr_t material;
		uintptr_t forwardMaterial;
		uint32_t unkc8;
		uint32_t targetName;
		uint64_t unkd0;
	};

	struct static_model_info {
		XModel* model;
		uint64_t unk8;
		uint64_t unk10;
		uintptr_t unk18;
		uint32_t unk20;
		uint32_t name;
		uint64_t unk28;
		uint32_t unk30;
		uint32_t unk34;
	};


	struct GfxWorld {
		XHash name;
		const char* baseName;
		int32_t surfaceCount;
		uint64_t unk20;
		uint64_t unk28;
		uint64_t unk30;
		uint64_t unk38;
		uint64_t unk40;
		uint64_t unk48;
		uint64_t unk50;
		uint64_t unk58;
		uint64_t unk60;
		uint64_t unk68;
		uint64_t unk70;
		uint64_t unk78;
		uint64_t unk80;
		uint64_t unk88;
		uint64_t unk90;
		uint64_t unk98;
		uint64_t unka0;
		uint64_t unka8;
		uint64_t unkb0;
		uint64_t unkb8;
		uint64_t unkc0;
		uint64_t unkc8;
		uint64_t unkd0;
		uint64_t unkd8;
		uint64_t unke0;
		uint64_t unke8;
		uint64_t unkf0;
		uint64_t unkf8;
		uint64_t unk100;
		uint64_t unk108;
		uint64_t unk110;
		uint64_t unk118;
		uint64_t unk120;
		uint64_t unk128;
		uint64_t unk130;
		uint64_t unk138;
		uint64_t unk140;
		uint64_t unk148;
		uint64_t unk150;
		uint64_t unk158;
		uint64_t unk160;
		uint64_t unk168;
		uint64_t unk170;
		uint64_t unk178;
		uint64_t unk180;
		uint64_t unk188;
		uint64_t unk190;
		uint64_t unk198;
		uint64_t unk1a0;
		uint32_t checksum;
		uint32_t unk1ac;
		uint64_t unk1b0;
		uint32_t unk1b8;
		uint32_t static_model_count;
		uint64_t unk1c0;
		uint64_t unk1c8;
		uint64_t unk1d0;
		uint64_t unk1d8;
		uint64_t unk1e0;
		uint64_t unk1e8;
		uint64_t unk1f0;
		uint64_t unk1f8;
		uint64_t unk200;
		uint64_t unk208;
		uint64_t unk210;
		uint64_t unk218;
		uint64_t unk220;
		uint64_t unk228;
		uint64_t unk230;
		uint64_t unk238;
		uint64_t unk240;
		uint64_t unk248;
		uint64_t unk250;
		uint64_t unk258;
		uint64_t unk260;
		uint64_t unk268;
		uint64_t unk270;
		uint64_t unk278;
		uint64_t unk280;
		uint64_t unk288;
		uint64_t unk290;
		uint64_t unk298;
		uint64_t unk2a0;
		uint64_t unk2a8;
		uint64_t unk2b0;
		uint64_t unk2b8;
		uint64_t unk2c0;
		uint64_t unk2c8;
		uint64_t unk2d0;
		uint64_t unk2d8;
		uint64_t unk2e0;
		uint64_t unk2e8;
		uint64_t unk2f0;
		uint64_t unk2f8;
		uint64_t unk300;
		uint64_t unk308;
		uint64_t unk310;
		uint64_t unk318;
		uint64_t unk320;
		uint64_t unk328;
		uint64_t unk330;
		uint64_t unk338;
		uint64_t unk340;
		uint64_t unk348;
		uint64_t unk350;
		uint64_t unk358;
		uint64_t unk360;
		uint64_t unk368;
		uint64_t unk370;
		uint64_t unk378;
		uint64_t unk380;
		uint64_t unk388;
		uint64_t unk390;
		uint64_t unk398;
		uint64_t unk3a0;
		uint64_t unk3a8;
		uint64_t unk3b0;
		uint64_t unk3b8;
		uint64_t unk3c0;
		uint64_t unk3c8;
		uint64_t unk3d0;
		uint64_t unk3d8;
		uint64_t unk3e0;
		uint64_t unk3e8;
		uint64_t unk3f0;
		uint64_t unk3f8;
		static_model_info* static_model;
		uint64_t unk408;
		uint64_t unk410;
		uint64_t unk418;
		uint64_t unk420;
		uint64_t unk428;
		uint64_t unk430;
		uint64_t unk438;
		uint64_t unk440;
		uint64_t unk448;
		uint64_t unk450;
		uint64_t unk458;
		uint64_t unk460;
		uint64_t unk468;
		uint64_t unk470;
		uint64_t unk478;
		uint64_t unk480;
		uint64_t unk488;
		uint64_t unk490;
		void* unk498;
		uint64_t unk4a0;
		uint64_t unk4a8;
		uint64_t unk4b0;
		uint64_t unk4b8;
		uint64_t unk4c0;
		uint64_t unk4c8;
		uint64_t unk4d0;
		uint64_t unk4d8;
		uint64_t unk4e0;
		uint64_t unk4e8;
		uint64_t unk4f0;
		uint64_t unk4f8;
		uint64_t unk500;
		uint64_t unk508;
		uint64_t unk510;
		uint64_t unk518;
		uint64_t unk520;
		uint64_t unk528;
		uint64_t unk530;
		uint64_t unk538;
		Material* lutMaterial;
		Material* lutMaterialALT;
		GfxImage* unk550[4];
		uint64_t unk570;
		uint64_t unk578;
		uint64_t unk580;
		uint64_t unk588;
		uint32_t volumeDecalCount;
		GfxVolumeDecal* volumeDecals;
		uint64_t* volumeDecalUnk5a0;
		GfxImage* volumeDecalRevealTexture;
		uint64_t unk5b0;
		uint64_t unk5b8;
		uint64_t unk5c0;
		int32_t unk5c8;
		uint32_t unk5cc;
		uint64_t unk5d0;
		uint64_t unk5d8;
		uint64_t unk5e0;
		uint64_t unk5e8;
		uint64_t unk5f0;
		uint64_t unk5f8;
		uint64_t unk600;
		uint64_t unk608;
		uint64_t unk610;
		uint64_t unk618;
		uint64_t unk620;
		uint64_t unk628;
		uint64_t unk630;
		uint64_t unk638;
		uint64_t unk640;
		uint64_t unk648;
		uint64_t unk650;
		uint64_t unk658;
		uint64_t unk660;
		uint64_t unk668;
		uint64_t unk670;
		uint64_t unk678;
		uint64_t unk680;
		uint64_t unk688;
		uint64_t unk690;
		uint64_t unk698;
		uint64_t unk6a0;
		uint64_t unk6a8;
		uint64_t unk6b0;
		uint64_t unk6b8;
		uint64_t unk6c0;
		uint64_t unk6c8;
		uint64_t unk6d0;
		uint64_t unk6d8;
		uint64_t unk6e0;
		uint64_t unk6e8;
		uint64_t unk6f0;
		uint64_t unk6f8;
		uint64_t unk700;
		uint64_t unk708;
		uint64_t unk710;
		uint64_t unk718;
		uint64_t unk720;
		uint64_t unk728;
		uint64_t unk730;
		uint64_t unk738;
		uint64_t unk740;
		uint64_t unk748;
		uint64_t unk750;
		uint64_t unk758;
		uint64_t unk760;
		uint64_t unk768;
		uint64_t unk770;
		uint64_t unk778;
		uint64_t unk780;
		uint64_t unk788;
		uint64_t unk790;
		uint64_t unk798;
		uint64_t unk7a0;
		uint64_t unk7a8;
		uint64_t unk7b0;
		uint64_t unk7b8;
		uint64_t unk7c0;
		uint64_t unk7c8;
		uint64_t unk7d0;
		uint64_t unk7d8;
		uint64_t unk7e0;
		uint64_t unk7e8;
		uint64_t unk7f0;
		uint64_t unk7f8;
		uint64_t unk800;
		uint64_t unk808;
		uint64_t unk810;
		uint64_t unk818;
		uint64_t unk820;
		uint64_t unk828;
		uint64_t unk830;
		uint64_t unk838;
		uint64_t unk840;
		uint64_t unk848;
		uint64_t unk850;
		uint64_t unk858;
		uint64_t unk860;
		uint64_t unk868;
		uint64_t unk870;
		uint64_t unk878;
		uint64_t unk880;
		uint64_t unk888;
		uint64_t unk890;
		uint64_t unk898;
		uint64_t unk8a0;
		uint64_t unk8a8;
		uint64_t unk8b0;
		uint64_t unk8b8;
		uint64_t unk8c0;
		uint64_t unk8c8;
		uint64_t unk8d0;
		uint64_t unk8d8;
		uint64_t unk8e0;
		uint64_t unk8e8;
		uint64_t unk8f0;
		uint64_t unk8f8;
		uint64_t unk900;
		uint64_t unk908;
		uint64_t unk910;
		uint64_t unk918;
		uint64_t unk920;
		uint64_t unk928;
		uint64_t unk930;
		uint64_t unk938;
		uint64_t unk940;
		uint64_t unk948;
		uint64_t unk950;
		uint64_t unk958;
		uint64_t unk960;
		uint64_t unk968;
		uint64_t unk970;
		uint64_t unk978;
		uint64_t unk980;
		uint64_t unk988;
		uint64_t unk990;
		uint64_t unk998;
		uint64_t unk9a0;
		uint64_t unk9a8;
		uint64_t unk9b0;
		uint64_t unk9b8;
		uint64_t unk9c0;
		uint64_t unk9c8;
		uint64_t unk9d0;
		uint64_t unk9d8;
		uint64_t unk9e0;
		uint64_t unk9e8;
		uint64_t unk9f0;
		uint64_t unk9f8;
		uint64_t unka00;
		uint64_t unka08;
		uint64_t unka10;
		uint64_t unka18;
		uint64_t unka20;
		uint64_t unka28;
		uint64_t unka30;
		uint64_t unka38;
		uint64_t unka40;
		uint64_t unka48;
		uint64_t unka50;
		uint64_t unka58;
		uint64_t unka60;
		uint64_t unka68;
		uint64_t unka70;
		uint64_t unka78;
		uint64_t unka80;
		uint64_t unka88;
		uint64_t unka90;
		uint64_t unka98;
		uint64_t unkaa0;
		uint64_t unkaa8;
		uint64_t unkab0;
		uint64_t unkab8;
		uint64_t unkac0;
		uint64_t unkac8;
		uint64_t unkad0;
		uint64_t unkad8;
		uint64_t unkae0;
		uint64_t unkae8;
		uint64_t unkaf0;
		uint64_t unkaf8;
		uint64_t unkb00;
		uint64_t unkb08;
		uint64_t unkb10;
		uint64_t unkb18;
		uint64_t unkb20;
		uint64_t unkb28;
		uint64_t unkb30;
		uint64_t unkb38;
		uint64_t unkb40;
		uint64_t unkb48;
		uint64_t unkb50;
		uint64_t unkb58;
		uint64_t unkb60;
		uint64_t unkb68;
		uint64_t unkb70;
		uint64_t unkb78;
		uint64_t unkb80;
		uint64_t unkb88;
		uint64_t unkb90;
		uint64_t unkb98;
		uint64_t unkba0;
		uint64_t unkba8;
		uint64_t unkbb0;
		uint64_t unkbb8;
		uint64_t unkbc0;
		uint64_t unkbc8;
		uint64_t unkbd0;
		uint64_t unkbd8;
		uint64_t unkbe0;
		uint64_t unkbe8;
		uint64_t unkbf0;
		uint64_t unkbf8;
		uint64_t unkc00;
		uint64_t unkc08;
		uint64_t unkc10;
		uint64_t unkc18;
		uint64_t unkc20;
		uint64_t unkc28;
		uint64_t unkc30;
		uint64_t unkc38;
		uint64_t unkc40;
		uint64_t unkc48;
		uint64_t unkc50;
		uint64_t unkc58;
		uint64_t unkc60;
		uint64_t unkc68;
		uint64_t unkc70;
		uint64_t unkc78;
		uint64_t unkc80;
		uint64_t unkc88;
		uint64_t unkc90;
		uint64_t unkc98;
		uint64_t unkca0;
		uint64_t unkca8;
		uint64_t unkcb0;
		uint64_t unkcb8;
		uint64_t unkcc0;
		uint64_t unkcc8;
		uint64_t unkcd0;
		uint64_t unkcd8;
		uint64_t unkce0;
		uint64_t unkce8;
		uint64_t unkcf0;
		uint64_t unkcf8;
		uint64_t unkd00;
		uint64_t unkd08;
		uint64_t unkd10;
		uint64_t unkd18;
		uint64_t unkd20;
		uint64_t unkd28;
		uint64_t unkd30;
		uint64_t unkd38;
		uint64_t unkd40;
		uint64_t unkd48;
		uint64_t unkd50;
		uint64_t unkd58;
		uint64_t unkd60;
		uint64_t unkd68;
		uint64_t unkd70;
		uint64_t unkd78;
		uint64_t unkd80;
		uint64_t unkd88;
		uint64_t unkd90;
		uint64_t unkd98;
		uint64_t unkda0;
		uint64_t unkda8;
		uint64_t unkdb0;
		uint64_t unkdb8;
		uint64_t unkdc0;
		uint64_t unkdc8;
		uint64_t unkdd0;
		uint64_t unkdd8;
		uint64_t unkde0;
		uint64_t unkde8;
		uint64_t unkdf0;
		uint64_t unkdf8;
		uint64_t unke00;
		uint64_t unke08;
		uint64_t unke10;
		uint64_t unke18;
		uint64_t unke20;
		uint64_t unke28;
		uint64_t unke30;
		uint64_t unke38;
		uint64_t unke40;
		uint64_t unke48;
		uint64_t unke50;
		uint64_t unke58;
		uint64_t unke60;
		uint64_t unke68;
		uint64_t unke70;
		uint64_t unke78;
		uint64_t unke80;
		uint64_t unke88;
		uint64_t unke90;
		uint64_t unke98;
		uint64_t unkea0;
		uint64_t unkea8;
		uint64_t unkeb0;
		uint64_t unkeb8;
		uint64_t unkec0;
		uint64_t unkec8;
		uint64_t unked0;
		uint64_t unked8;
		uint64_t unkee0;
		uint64_t unkee8;
		uint64_t unkef0;
		uint64_t unkef8;
		uint64_t unkf00;
		uint64_t unkf08;
		uint64_t unkf10;
		uint64_t unkf18;
		uint64_t unkf20;
		uint64_t unkf28;
		uint64_t unkf30;
		uint64_t unkf38;
		uint64_t unkf40;
		uint64_t unkf48;
		uint64_t unkf50;
		uint64_t unkf58;
		uint64_t unkf60;
		uint64_t unkf68;
		uint64_t unkf70;
		uint64_t unkf78;
		uint64_t unkf80;
		uint64_t unkf88;
		uint64_t unkf90;
		uint64_t unkf98;
		uint64_t unkfa0;
		uint64_t unkfa8;
		uint64_t unkfb0;
		uint64_t unkfb8;
		uint64_t unkfc0;
		uint64_t unkfc8;
		uint64_t unkfd0;
		uint64_t unkfd8;
		uint64_t unkfe0;
		uint64_t unkfe8;
		uint64_t unkff0;
		uint64_t unkff8;
		uint64_t unk1000;
		uint64_t unk1008;
		uint64_t unk1010;
		uint64_t unk1018;
		uint64_t unk1020;
		uint64_t unk1028;
		uint64_t unk1030;
		uint64_t unk1038;
		uint64_t unk1040;
		uint64_t unk1048;
		uint64_t unk1050;
		uint64_t unk1058;
		uint64_t unk1060;
		uint64_t unk1068;
		uint64_t unk1070;
		uint64_t unk1078;
		uint64_t unk1080;
		uint64_t unk1088;
		uint64_t unk1090;
		uint64_t unk1098;
		uint64_t unk10a0;
		uint64_t unk10a8;
		uint64_t unk10b0;
		uint64_t unk10b8;
		uint64_t unk10c0;
		uint64_t unk10c8;
		uint64_t unk10d0;
		uint64_t unk10d8;
		uint64_t unk10e0;
		uint64_t unk10e8;
		uint64_t unk10f0;
		uint64_t unk10f8;
		uint64_t unk1100;
		uint64_t unk1108;
		uint64_t unk1110;
		uint64_t unk1118;
		uint64_t unk1120;
		uint64_t unk1128;
		uint64_t unk1130;
		uint64_t unk1138;
		uint64_t unk1140;
		uint64_t unk1148;
		uint64_t unk1150;
		uint64_t unk1158;
		uint64_t unk1160;
		uint64_t unk1168;
		uint64_t unk1170;
		uint64_t unk1178;
		uint64_t unk1180;
		uint64_t unk1188;
		uint64_t unk1190;
		uint64_t unk1198;
		uint64_t unk11a0;
		uint64_t unk11a8;
		uint64_t unk11b0;
		uint64_t unk11b8;
		uint64_t unk11c0;
		uint64_t unk11c8;
		uint64_t unk11d0;
		uint64_t unk11d8;
		uint64_t unk11e0;
		uint64_t unk11e8;
		uint64_t unk11f0;
		uint64_t unk11f8;
		uint64_t unk1200;
		uint64_t unk1208;
		uint64_t unk1210;
		uint64_t unk1218;
		uint64_t unk1220;
		uint64_t unk1228;
		uint64_t unk1230;
		uint64_t unk1238;
		uint64_t unk1240;
		uint64_t unk1248;
		uint64_t unk1250;
		uint64_t unk1258;
		uint64_t unk1260;
		uint64_t unk1268;
		uint64_t unk1270;
		uint64_t unk1278;
		uint64_t unk1280;
		uint64_t unk1288;
		uint64_t unk1290;
		uint64_t unk1298;
		uint64_t unk12a0;
		uint64_t unk12a8;
		uint64_t unk12b0;
		uint64_t unk12b8;
		uint64_t unk12c0;
		uint64_t unk12c8;
		uint64_t unk12d0;
		uint64_t unk12d8;
		uint64_t unk12e0;
		uint64_t unk12e8;
		uint64_t unk12f0;
		uint64_t unk12f8;
		uint64_t unk1300;
		uint64_t unk1308;
		uint64_t unk1310;
		uint64_t unk1318;
		uint64_t unk1320;
		uint64_t unk1328;
		uint64_t unk1330;
		uint64_t unk1338;
		uint64_t unk1340;
		uint64_t unk1348;
		uint64_t unk1350;
		uint64_t unk1358;
		uint64_t unk1360;
		uint64_t unk1368;
		uint64_t unk1370;
		uint64_t unk1378;
		uint64_t unk1380;
		uint64_t unk1388;
		uint64_t unk1390;
		uint64_t unk1398;
		uint64_t unk13a0;
		uint64_t unk13a8;
		uint64_t unk13b0;
		uint64_t unk13b8;
		uint64_t unk13c0;
		uint64_t unk13c8;
		uint64_t unk13d0;
		uint64_t unk13d8;
		uint64_t unk13e0;
		uint64_t unk13e8;
		uint64_t unk13f0;
		uint64_t unk13f8;
		uint64_t unk1400;
		uint64_t unk1408;
		uint64_t unk1410;
		uint64_t unk1418;
		uint64_t unk1420;
		uint64_t unk1428;
		uint64_t unk1430;
		uint64_t unk1438;
		uint64_t unk1440;
		uint64_t unk1448;
		uint64_t unk1450;
		uint64_t unk1458;
		uint64_t unk1460;
		uint64_t unk1468;
		uint64_t unk1470;
		uint64_t unk1478;
		uint64_t unk1480;
		uint64_t unk1488;
		uint64_t unk1490;
		uint64_t unk1498;
		uint64_t unk14a0;
		uint64_t unk14a8;
		uint64_t unk14b0;
		uint64_t unk14b8;
		uint64_t unk14c0;
		uint64_t unk14c8;
		uint64_t unk14d0;
		uint64_t unk14d8;
		uint64_t unk14e0;
		uint64_t unk14e8;
		uint64_t unk14f0;
		uint64_t unk14f8;
		uint64_t unk1500;
		uint64_t unk1508;
		uint64_t unk1510;
		uint64_t unk1518;
		uint64_t unk1520;
		uint64_t unk1528;
		uint64_t unk1530;
		uint64_t unk1538;
		uint64_t unk1540;
		uint64_t unk1548;
		uint64_t unk1550;
		uint64_t unk1558;
		uint64_t unk1560;
		uint64_t unk1568;
		uint64_t unk1570;
		uint64_t unk1578;
		uint64_t unk1580;
		uint64_t unk1588;
		uint64_t unk1590;
		uint64_t unk1598;
		uint64_t unk15a0;
		uint64_t unk15a8;
		uint64_t unk15b0;
		uint64_t unk15b8;
		uint64_t unk15c0;
		uint64_t unk15c8;
		uint64_t unk15d0;
		uint64_t unk15d8;
		uint64_t unk15e0;
		uint64_t unk15e8;
		uint64_t unk15f0;
		uint64_t unk15f8;
		uint64_t unk1600;
		uint64_t unk1608;
		uint64_t unk1610;
		uint64_t unk1618;
		uint64_t unk1620;
		uint64_t unk1628;
		uint64_t unk1630;
		uint64_t unk1638;
		uint64_t unk1640;
		uint64_t unk1648;
		uint64_t unk1650;
		uint64_t unk1658;
		uint64_t unk1660;
		uint64_t unk1668;
		uint64_t unk1670;
		uint64_t unk1678;
		uint64_t unk1680;
		uint64_t unk1688;
		uint64_t unk1690;
		uint64_t unk1698;
		uint64_t unk16a0;
		uint64_t unk16a8;
		uint64_t unk16b0;
		uint32_t unk16b8;
		uint32_t unk16bc;
		uint64_t unk16c0;
		uint32_t unk16c8[4];
		uint32_t unk16d8[32];
		uint32_t unk1a48_count;
		uint32_t unk175c;
		uint64_t unk1760;
		uint64_t unk1768;
		uint64_t unk1770;
		uint64_t unk1778;
		uint64_t unk1780;
		uint32_t unk1a38_count;
		uint32_t unk178c;
		uint64_t unk1790;
		uint64_t unk1798;
		uint64_t unk17a0;
		uint64_t unk17a8;
		uint64_t unk17b0;
		uint64_t unk17b8;
		uint64_t unk17c0;
		uint64_t unk17c8;
		uint64_t unk17d0;
		uint32_t unk1a40_count;
		uint32_t unk17dc;
		uint64_t unk17e0;
		uint64_t unk17e8;
		uint64_t unk17f0;
		byte* lighting;
		byte* streamerworld;
		uint64_t unk1808;
		uint64_t unk1810;
		uint64_t unk1818;
		uint64_t unk1820;
		uint64_t unk1828;
		uint64_t unk1830;
		uint64_t unk1838;
		uint64_t unk1840;
		uint64_t unk1848;
		uint64_t unk1850;
		uint64_t unk1858;
		uint64_t unk1860;
		uint64_t unk1868;
		uint64_t unk1870;
		uint64_t unk1878;
		uint64_t unk1880;
		uint64_t unk1888;
		uint64_t unk1890;
		uint32_t unk1898[4];
		uint32_t unk18a8[32];
		uint64_t unk1928;
		uint64_t unk1930;
		uint64_t unk1938;
		uint64_t unk1940;
		uint64_t unk1948;
		uint64_t unk1950;
		uint32_t unk1a50_count;
		uint32_t unk195c;
		uint64_t unk1960;
		uint32_t unk1968[4];
		uint32_t unk1978[32];
		uint32_t unk19f8;
		uint32_t unk19fc;
		uint64_t unk1a00;
		uint64_t unk1a08;
		uint64_t unk1a10;
		uint64_t unk1a18;
		uint64_t unk1a20;
		uint32_t unk1a58_count;
		uint32_t unk1a2c;
		uint64_t unk1a30;
		byte* unk1a38;
		byte* unk1a40;
		byte* unk1a48;
		byte* unk1a50;
		byte* unk1a58;
		GfxImage* unk1a60[10];
	};
	static_assert(sizeof(GfxWorld) == 0x1ab0);

	class GfxWorldWorker : public Worker {

		void Unlink(fastfile::FastFileOption& opt, void* ptr) {
			GfxWorld& asset{ *(GfxWorld*)ptr };


			BO4JsonWriter json{};

			json.BeginObject();
			json.WriteFieldValueXHash("name", asset.name);
			json.WriteFieldValueXString("baseName", asset.baseName);
			json.WriteFieldValueXAsset("lutMaterial", ASSET_TYPE_MATERIAL, asset.lutMaterial);
			json.WriteFieldValueXAsset("lutMaterialALT", ASSET_TYPE_MATERIAL, asset.lutMaterialALT);
			json.WriteFieldValueXAsset("volumeDecalRevealTexture", ASSET_TYPE_IMAGE, asset.volumeDecalRevealTexture);
			json.WriteFieldValueXAssetArray("unk550", ASSET_TYPE_IMAGE, ARRAYSIZE(asset.unk550), asset.unk550);
			json.WriteFieldValueXAssetArray("unk1a60", ASSET_TYPE_IMAGE, ARRAYSIZE(asset.unk1a60), asset.unk1a60);

			json.EndObject();

			const char* name{ hashutils::ExtractPtr(asset.name) };
			if (!name) {
				name = utils::va("maps/hashed/file_%llx.d3dbsp", asset.name.name);
			}

			std::filesystem::path outFile{ opt.m_output / "bo4" / "source" / name / "gfx_map.json" };

			std::filesystem::create_directories(outFile.parent_path());
			LOG_INFO("Dump gfx_map {}", outFile.string());

			if (!json.WriteToFile(outFile)) {
				LOG_ERROR("Error when dumping {}", outFile.string());
			}
		}
	};
	utils::MapAdder<GfxWorldWorker, games::bo4::pool::XAssetType, Worker> implgfx{ GetWorkers(), games::bo4::pool::XAssetType::ASSET_TYPE_GFXWORLD };
}